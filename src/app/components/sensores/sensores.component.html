<div class="page-container">
  <header class="page-header">
    <h1>Gerenciamento de Sensores</h1>
    <div class="header-buttons">
      <button mat-stroked-button (click)="openSimulateDialog()">
        <mat-icon>play_circle_outline</mat-icon>
        Simular Dados
      </button>
      <button mat-raised-button color="primary" (click)="adicionarSensor()">
        <mat-icon>add</mat-icon>
        Adicionar Novo Sensor
      </button>
    </div>
  </header>

  <div class="sensors-grid" *ngIf="(sensors$ | async) as sensors">
    <div *ngIf="sensors.length === 0" class="no-sensors-message">
      <mat-icon>sensors_off</mat-icon>
      <p>Nenhum sensor conectado no momento.</p>
      <small>Clique em "Adicionar Novo Sensor" para começar.</small>
    </div>

    <div *ngFor="let sensor of sensors">
      <mat-card *ngIf="!sensor.isAssociated" class="new-sensor-card">
        <mat-card-title>Novo Sensor Encontrado</mat-card-title>
        <mat-card-content>
          <p>ID do Dispositivo: {{ sensor.id }}</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button color="primary" (click)="configureSensor(sensor.id)">Configurar</button>
        </mat-card-actions>
      </mat-card>

      <mat-card *ngIf="sensor.isAssociated" class="sensor-card" [ngClass]="{'is-offline': sensor.status === 'offline'}">
        <mat-card-header>
          <mat-icon mat-card-avatar>{{ sensor.status === 'offline' ? 'wifi_off' : 'wifi_tethering' }}</mat-icon>
          <mat-card-title>{{ sensor.name }}</mat-card-title>
          <mat-card-subtitle [ngClass]="{'offline-text': sensor.status === 'offline'}">
            {{ sensor.status === 'offline' ? 'Offline' : 'Online' }}
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p><strong>Cultura:</strong> {{ sensor.culture }}</p>
          <p><strong>Umidade:</strong> {{ sensor.humidity.toFixed(2) }} %</p>
          <p><small><strong>Último Contato:</strong> {{ formatTimestamp(sensor.lastUpdate) }}</small></p>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-button color="accent" (click)="configureSensor(sensor.id)">Editar</button>
          <button mat-button color="warn" (click)="removerSensor(sensor)" [disabled]="sensor.status === 'offline'">
            Remover
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>